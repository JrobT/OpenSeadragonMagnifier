!function(e){"use strict";function i(e,i){e.style.webkitTransform="rotate("+i+"deg)",e.style.mozTransform="rotate("+i+"deg)",e.style.msTransform="rotate("+i+"deg)",e.style.oTransform="rotate("+i+"deg)",e.style.transform="rotate("+i+"deg)"}function t(e,i){for(var t,o=0;o<i.world.getItemCount();o++)t=i.world.getItemAt(o),e.world.addItem(n(e,t));i.world.addHandler("add-item",function(t){e.world.addItem(n(e,t.item),{index:i.world.getIndexOfItem(t.item)})})}function n(i,t){var n=new e.TiledImage({viewer:i,source:t.source,viewport:i.viewport,drawer:i.drawer,tileCache:t._tileCache,imageLoader:t._imageLoader,clip:t._clip,placeholderFillStyle:t.placeholderFillStyle,opacity:t.opacity,springStiffness:i.springStiffness,animationTime:i.animationTime,minZoomImageRatio:i.minZoomImageRatio,wrapHorizontal:i.wrapHorizontal,wrapVertical:i.wrapVertical,immediateRender:i.immediateRender,blendTime:i.blendTime,alwaysBlend:i.alwaysBlend,minPixelRatio:i.minPixelRatio,smoothTileEdgesMinZoom:i.smoothTileEdgesMinZoom,crossOriginPolicy:i.crossOriginPolicy,debugMode:i.debugMode});return n._originalForNavigator=t,i._matchBounds(n,t,!0),t.addHandler("bounds-change",function(){i._matchBounds(n,t)}),n}function o(){}function r(){}if(!e.version||e.version.major<2)throw new Error("This version of MpenSeadragonmagnifier requires OpenSeadragon version 2.0.0+");e.Viewer.prototype.magnifier=function(i){return this.magnifierInstance&&!i||(i=i||{},i.viewer=this,this.magnifierInstance=new e.Magnifier(i)),this.magnifierInstance},e.Magnifier=function(n){var a,s,l=n.viewer,d=this;n.id?(this.element=document.getElementById(n.id),n.controlOptions={anchor:e.ControlAnchor.NONE,attachToViewer:!1,autoFade:!1}):(n.id="magnifier-"+e.now(),this.element=e.makeNeutralElement("div"),n.controlOptions={anchor:e.ControlAnchor.TOP_RIGHT,attachToViewer:!0,autoFade:!0},n.position&&("BOTTOM_RIGHT"===n.position?n.controlOptions.anchor=e.ControlAnchor.BOTTOM_RIGHT:"BOTTOM_LEFT"===n.position?n.controlOptions.anchor=e.ControlAnchor.BOTTOM_LEFT:"TOP_RIGHT"===n.position?n.controlOptions.anchor=e.ControlAnchor.TOP_RIGHT:"TOP_LEFT"===n.position?n.controlOptions.anchor=e.ControlAnchor.TOP_LEFT:"ABSOLUTE"===n.position&&(n.controlOptions.anchor=e.ControlAnchor.ABSOLUTE,n.controlOptions.top=n.top,n.controlOptions.left=n.left,n.controlOptions.height=n.height,n.controlOptions.width=n.width))),this.element.id=n.id,this.element.className+=" magnifier",n=e.extend(!0,e.DEFAULT_SETTINGS,{sizeRatio:.2,minPixelRatio:l.minPixelRatio,magnifierRotate:!0},n,{element:this.element,tabIndex:-1,showNavigator:!1,showNavigationControl:!1,showSequenceControl:!1,magnifier:null,immediateRender:!0,blendTime:0,animationTime:0,autoResize:n.autoResize,minZoomImageRatio:1}),e.setElementTouchActionNone(this.element),this.borderWidth=2,this.fudge=new e.Point(1,1),this.totalBorderWidths=new e.Point(2*this.borderWidth,2*this.borderWidth).minus(this.fudge),n.controlOptions.anchor!==e.ControlAnchor.NONE&&!function(e,i){e.margin="0px",e.border=i+"px solid #555",e.padding="0px",e.background="#000",e.overflow="hidden"}(this.element.style,this.borderWidth),this.displayRegion=e.makeNeutralElement("div"),this.displayRegion.id=this.element.id+"-displayregion",this.displayRegion.className="displayregion",function(e,i){e.position="absolute",e.border=i+"px solid #900",e.margin="0px",e.padding="0px"}(this.displayRegion.style,this.borderWidth),this.regionMoveHangle=e.makeNeutralElement("div"),this.regionMoveHangle.id=this.element.id+"-displayregion-move",this.regionMoveHangle.className="displayregion-move",this.regionMoveHangle.style.width="10%",this.regionMoveHangle.style.height="10%",this.regionMoveHangle.style.maxWidth="50px",this.regionMoveHangle.style.maxHeight="50px",this.regionMoveHangle.style.cursor="move",new e.MouseTracker({element:this.regionMoveHangle,dragHandler:o.bind(this)}),this.regionResizeHangle=e.makeNeutralElement("div"),this.regionResizeHangle.id=this.element.id+"-displayregion-move",this.regionResizeHangle.className="displayregion-move",this.regionResizeHangle.style.position="absolute",this.regionResizeHangle.style.bottom="-1px",this.regionResizeHangle.style.right="-1px",this.regionResizeHangle.style.width="10%",this.regionResizeHangle.style.height="10%",this.regionResizeHangle.style.maxWidth="50px",this.regionResizeHangle.style.maxHeight="50px",this.regionResizeHangle.style.cursor="se-resize",new e.MouseTracker({element:this.regionResizeHangle,dragHandler:r.bind(this)}),this.displayRegionContainer=e.makeNeutralElement("div"),this.displayRegionContainer.id=this.element.id+"-displayregioncontainer",this.displayRegionContainer.className="displayregioncontainer",this.displayRegionContainer.style.width="0",this.displayRegionContainer.style.height="0",l.addControl(this.element,n.controlOptions),this._resizeWithViewer=n.controlOptions.anchor!==e.ControlAnchor.ABSOLUTE&&n.controlOptions.anchor!==e.ControlAnchor.NONE,this._resizeWithViewer&&(n.width&&n.height?(this.element.style.height="number"==typeof n.height?n.height+"px":n.height,this.element.style.width="number"==typeof n.width?n.width+"px":n.width):(a=e.getElementSize(l.element),this.element.style.height=Math.round(a.y*n.sizeRatio)+"px",this.element.style.width=Math.round(a.x*n.sizeRatio)+"px",this.oldViewerSize=a),s=e.getElementSize(this.element),this.elementArea=s.x*s.y),this.oldContainerSize=new e.Point(0,0),e.Viewer.apply(this,[n]),this.displayRegion.appendChild(this.regionMoveHangle),this.displayRegion.appendChild(this.regionResizeHangle),this.displayRegionContainer.appendChild(this.displayRegion),l.canvas.appendChild(this.displayRegionContainer),n.magnifierRotate&&l.addHandler("rotate",function(e){var t=l.viewport.pixelFromPoint(l.viewport.getCenter(),!0);d.displayRegionContainer.style.transformOrigin=t.x+"px "+t.y+"px",i(d.displayRegionContainer,e.degrees),i(d.displayRegion,-e.degrees),d.viewport.setRotation(e.degrees)}),this.addHandler("reset-size",function(){d.viewport&&d.viewport.goHome(!0)}),this.addHandler("update-level",function(){l.viewport&&d.update(l.viewport)}),l.addHandler("update-level",function(){l.viewport&&d.update(l.viewport)}),l.addHandler("close",function(){d.close()}),l.addHandler("full-page",function(){l.viewport&&d.update(l.viewport)}),l.addHandler("full-screen",function(){l.viewport&&d.update(l.viewport)}),l.world.addHandler("update-viewport",function(){l.viewport&&d.update(l.viewport)}),l.world.addHandler("item-index-change",function(e){var i=d.world.getItemAt(e.previousIndex);d.world.setItemIndex(i,e.newIndex)}),l.world.addHandler("remove-item",function(e){var i=e.item,t=d._getMatchingItem(i);t&&d.world.removeItem(t)}),t(this,l),this.update(l.viewport)},e.extend(e.Magnifier.prototype,e.Viewer.prototype,{updateSize:function(){if(this.viewport){var i=new e.Point(0===this.container.clientWidth?1:this.container.clientWidth,0===this.container.clientHeight?1:this.container.clientHeight);i.equals(this.oldContainerSize)||(this.viewport.resize(i,!0),this.viewport.goHome(!0),this.oldContainerSize=i,this.drawer.clear(),this.world.draw())}},update:function(i){var t=e.getElementSize(this.viewer.element);if(this._resizeWithViewer&&t.x&&t.y&&!t.equals(this.oldViewerSize)){var n,o;this.oldViewerSize=t,this.maintainSizeRatio||!this.elementArea?(n=t.x*this.sizeRatio,o=t.y*this.sizeRatio):(n=Math.sqrt(this.elementArea*(t.x/t.y)),o=this.elementArea/n),this.element.style.width=Math.round(n)+"px",this.element.style.height=Math.round(o)+"px",this.elementArea||(this.elementArea=n*o),this.updateSize()}if(i&&this.viewport){var r=this.viewport.getBounds(!0),a=i.pixelFromPoint(r.getTopLeft(),!0),s=i.pixelFromPoint(r.getBottomRight(),!0).minus(this.totalBorderWidths),l=this.displayRegion.style;l.display=this.world.getItemCount()?"block":"none",l.top=Math.round(a.y)+"px",l.left=Math.round(a.x)+"px";var d=Math.abs(a.x-s.x),h=Math.abs(a.y-s.y);l.width=Math.round(Math.max(d,0))+"px",l.height=Math.round(Math.max(h,0))+"px"}},addTiledImage:function(i){var t=this,n=i.originalTiledImage;delete i.original;var o=e.extend({},i,{success:function(e){var i=e.item;i._originalForNavigator=n,t._matchBounds(i,n,!0),n.addHandler("bounds-change",function(){t._matchBounds(i,n)})}});return e.Viewer.prototype.addTiledImage.apply(this,[o])},_getMatchingItem:function(e){for(var i,t=this.world.getItemCount(),n=0;n<t;n++)if(i=this.world.getItemAt(n),i._originalForNavigator===e)return i;return null},_matchBounds:function(e,i,t){var n=i.getBounds();e.setPosition(n.getTopLeft(),t),e.setWidth(n.width,t)}})}(OpenSeadragon);
//# sourceMappingURL=openseadragonmagnifier.js.map
