!function(e){"use strict";function t(e,t){e.style.webkitTransform="rotate("+t+"deg)",e.style.mozTransform="rotate("+t+"deg)",e.style.msTransform="rotate("+t+"deg)",e.style.oTransform="rotate("+t+"deg)",e.style.transform="rotate("+t+"deg)"}function i(e,t){var i;console.log(t.world.getItemCount());for(var n=0;n<t.world.getItemCount();n++)i=t.world.getItemAt(n),e.world.addItem(i);t.world.addHandler("add-item",function(i){console.log("add"),e.world.addItem(o(e,i.item),{index:t.world.getIndexOfItem(i.item)})})}function o(t,i){return new e.TiledImage({viewer:t,source:i.source,viewport:t.viewport,drawer:t.drawer,tileCache:i._tileCache,imageLoader:i._imageLoader,x:i.x,y:i.y,width:i.width,height:i.height,clip:i._clip,placeholderFillStyle:i.placeholderFillStyle,opacity:i.opacity,springStiffness:t.springStiffness,animationTime:t.animationTime,minZoomImageRatio:t.minZoomImageRatio,wrapHorizontal:t.wrapHorizontal,wrapVertical:t.wrapVertical,immediateRender:t.immediateRender,blendTime:t.blendTime,alwaysBlend:t.alwaysBlend,minPixelRatio:t.minPixelRatio,smoothTileEdgesMinZoom:t.smoothTileEdgesMinZoom,crossOriginPolicy:t.crossOriginPolicy,debugMode:t.debugMode})}if(!e.version||e.version.major<2)throw new Error("This version of MpenSeadragonmagnifier requires OpenSeadragon version 2.0.0+");e.Viewer.prototype.magnifier=function(t){return(!this.magnifierInstance||t)&&(t=t||{},t.viewer=this,this.magnifierInstance=new e.Magnifier(t)),this.magnifierInstance},e.Magnifier=function(o){var n,r,a=o.viewer,s=this;o.id?(this.element=document.getElementById(o.id),o.controlOptions={anchor:e.ControlAnchor.NONE,attachToViewer:!1,autoFade:!1}):(o.id="magnifier-"+e.now(),this.element=e.makeNeutralElement("div"),o.controlOptions={anchor:e.ControlAnchor.TOP_RIGHT,attachToViewer:!0,autoFade:!0},o.position&&("BOTTOM_RIGHT"===o.position?o.controlOptions.anchor=e.ControlAnchor.BOTTOM_RIGHT:"BOTTOM_LEFT"===o.position?o.controlOptions.anchor=e.ControlAnchor.BOTTOM_LEFT:"TOP_RIGHT"===o.position?o.controlOptions.anchor=e.ControlAnchor.TOP_RIGHT:"TOP_LEFT"===o.position?o.controlOptions.anchor=e.ControlAnchor.TOP_LEFT:"ABSOLUTE"===o.position&&(o.controlOptions.anchor=e.ControlAnchor.ABSOLUTE,o.controlOptions.top=o.top,o.controlOptions.left=o.left,o.controlOptions.height=o.height,o.controlOptions.width=o.width))),this.element.id=o.id,this.element.className+=" magnifier",o=e.extend(!0,{sizeRatio:.2},o,{element:this.element,tabIndex:-1,showNavigator:!1,mouseNavEnabled:!1,showNavigationControl:!1,showSequenceControl:!1,immediateRender:!0,blendTime:0,animationTime:0,autoResize:o.autoResize,minZoomImageRatio:1}),o.minPixelRatio=this.minPixelRatio=a.minPixelRatio,e.setElementTouchActionNone(this.element),this.borderWidth=2,this.fudge=new e.Point(1,1),this.totalBorderWidths=new e.Point(2*this.borderWidth,2*this.borderWidth).minus(this.fudge),o.controlOptions.anchor!==e.ControlAnchor.NONE&&!function(e,t){e.margin="0px",e.border=t+"px solid #555",e.padding="0px",e.background="#000",e.opacity=.8,e.overflow="hidden"}(this.element.style,this.borderWidth),this.displayRegion=e.makeNeutralElement("div"),this.displayRegion.id=this.element.id+"-displayregion",this.displayRegion.className="displayregion",function(e,t){e.position="relative",e.top="0px",e.left="0px",e.fontSize="0px",e.overflow="hidden",e.border=t+"px solid #900",e.margin="0px",e.padding="0px",e.background="transparent",e["float"]="left",e.cssFloat="left",e.styleFloat="left",e.zIndex=999999999,e.cursor="default"}(this.displayRegion.style,this.borderWidth),this.displayRegionContainer=e.makeNeutralElement("div"),this.displayRegionContainer.id=this.element.id+"-displayregioncontainer",this.displayRegionContainer.className="displayregioncontainer",this.displayRegionContainer.style.width="100%",this.displayRegionContainer.style.height="100%",a.addControl(this.element,o.controlOptions),this._resizeWithViewer=o.controlOptions.anchor!==e.ControlAnchor.ABSOLUTE&&o.controlOptions.anchor!==e.ControlAnchor.NONE,this._resizeWithViewer&&(o.width&&o.height?(this.element.style.height="number"==typeof o.height?o.height+"px":o.height,this.element.style.width="number"==typeof o.width?o.width+"px":o.width):(n=e.getElementSize(a.element),this.element.style.height=Math.round(n.y*o.sizeRatio)+"px",this.element.style.width=Math.round(n.x*o.sizeRatio)+"px",this.oldViewerSize=n),r=e.getElementSize(this.element),this.elementArea=r.x*r.y),this.oldContainerSize=new e.Point(0,0),e.Viewer.apply(this,[o]),this.displayRegionContainer.appendChild(this.displayRegion),o.magnifierRotate&&o.viewer.addHandler("rotate",function(e){t(s.displayRegionContainer,e.degrees),t(s.displayRegion,-e.degrees),s.viewport.setRotation(e.degrees)}),this.addHandler("reset-size",function(){s.viewport&&s.viewport.goHome(!0)}),this.addHandler("reset-size",function(){s.viewport&&s.viewport.goHome(!0)}),a.world.addHandler("item-index-change",function(e){var t=s.world.getItemAt(e.previousIndex);s.world.setItemIndex(t,e.newIndex)}),a.world.addHandler("remove-item",function(e){var t=e.item,i=s._getMatchingItem(t);i&&s.world.removeItem(i)}),i(this,a),this.update(a.viewport)},e.extend(e.Magnifier.prototype,e.Viewer.prototype,{updateSize:function(){if(this.viewport){var t=new e.Point(0===this.container.clientWidth?1:this.container.clientWidth,0===this.container.clientHeight?1:this.container.clientHeight);t.equals(this.oldContainerSize)||(this.viewport.resize(t,!0),this.viewport.goHome(!0),this.oldContainerSize=t,this.drawer.clear(),this.world.draw())}},update:function(t){var i,o,n,r,a,s;if(i=e.getElementSize(this.viewer.element),this._resizeWithViewer&&i.x&&i.y&&!i.equals(this.oldViewerSize)&&(this.oldViewerSize=i,this.maintainSizeRatio||!this.elementArea?(o=i.x*this.sizeRatio,n=i.y*this.sizeRatio):(o=Math.sqrt(this.elementArea*(i.x/i.y)),n=this.elementArea/o),this.element.style.width=Math.round(o)+"px",this.element.style.height=Math.round(n)+"px",this.elementArea||(this.elementArea=o*n),this.updateSize()),t&&this.viewport){r=t.getBounds(!0),a=this.viewport.pixelFromPoint(r.getTopLeft(),!1),s=this.viewport.pixelFromPoint(r.getBottomRight(),!1).minus(this.totalBorderWidths);var l=this.displayRegion.style;l.display=this.world.getItemCount()?"block":"none",l.top=Math.round(a.y)+"px",l.left=Math.round(a.x)+"px";var d=Math.abs(a.x-s.x),h=Math.abs(a.y-s.y);l.width=Math.round(Math.max(d,0))+"px",l.height=Math.round(Math.max(h,0))+"px"}},addTiledImage:function(t){var i=this,o=t.originalTiledImage;delete t.original;var n=e.extend({},t,{success:function(e){var t=e.item;t._originalForNavigator=o,i._matchBounds(t,o,!0),o.addHandler("bounds-change",function(){i._matchBounds(t,o)})}});return e.Viewer.prototype.addTiledImage.apply(this,[n])},_getMatchingItem:function(e){for(var t,i=this.world.getItemCount(),o=0;i>o;o++)if(t=this.world.getItemAt(o),t._originalForNavigator===e)return t;return null},_matchBounds:function(e,t,i){var o=t.getBounds();e.setPosition(o.getTopLeft(),i),e.setWidth(o.width,i)}})}(OpenSeadragon);
//# sourceMappingURL=openseadragonmagnifier.js.map
