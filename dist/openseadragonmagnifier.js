!function(e){"use strict";function t(e,t){for(var o,n=0;n<t.world.getItemCount();n++)o=t.world.getItemAt(n),e.world.addItem(i(e,o));t.world.addHandler("add-item",function(o){e.world.addItem(i(e,o.item),{index:t.world.getIndexOfItem(o.item)})})}function i(t,i){var o=new e.TiledImage({viewer:t,source:i.source,viewport:t.viewport,drawer:t.drawer,tileCache:i._tileCache,imageLoader:i._imageLoader,clip:i._clip,placeholderFillStyle:i.placeholderFillStyle,opacity:i.opacity,springStiffness:t.springStiffness,animationTime:t.animationTime,minZoomImageRatio:t.minZoomImageRatio,wrapHorizontal:t.wrapHorizontal,wrapVertical:t.wrapVertical,immediateRender:t.immediateRender,blendTime:t.blendTime,alwaysBlend:t.alwaysBlend,minPixelRatio:t.minPixelRatio,smoothTileEdgesMinZoom:t.smoothTileEdgesMinZoom,crossOriginPolicy:t.crossOriginPolicy,debugMode:t.debugMode});return o._originalForNavigator=i,t._matchBounds(o,i,!0),i.addHandler("bounds-change",function(){t._matchBounds(o,i)}),o}if(!e.version||e.version.major<2)throw new Error("This version of MpenSeadragonmagnifier requires OpenSeadragon version 2.0.0+");e.Viewer.prototype.magnifier=function(t){return(!this.magnifierInstance||t)&&(t=t||{},t.viewer=this,this.magnifierInstance=new e.Magnifier(t)),this.magnifierInstance},e.Magnifier=function(i){var o,n,r=i.viewer,a=this;i.id?(this.element=document.getElementById(i.id),i.controlOptions={anchor:e.ControlAnchor.NONE,attachToViewer:!1,autoFade:!1}):(i.id="magnifier-"+e.now(),this.element=e.makeNeutralElement("div"),i.controlOptions={anchor:e.ControlAnchor.TOP_RIGHT,attachToViewer:!0,autoFade:!0},i.position&&("BOTTOM_RIGHT"===i.position?i.controlOptions.anchor=e.ControlAnchor.BOTTOM_RIGHT:"BOTTOM_LEFT"===i.position?i.controlOptions.anchor=e.ControlAnchor.BOTTOM_LEFT:"TOP_RIGHT"===i.position?i.controlOptions.anchor=e.ControlAnchor.TOP_RIGHT:"TOP_LEFT"===i.position?i.controlOptions.anchor=e.ControlAnchor.TOP_LEFT:"ABSOLUTE"===i.position&&(i.controlOptions.anchor=e.ControlAnchor.ABSOLUTE,i.controlOptions.top=i.top,i.controlOptions.left=i.left,i.controlOptions.height=i.height,i.controlOptions.width=i.width))),this.element.id=i.id,this.element.className+=" magnifier",i=e.extend(!0,e.DEFAULT_SETTINGS,{sizeRatio:.2,minPixelRatio:r.minPixelRatio,magnifierRotate:!0},i,{element:this.element,tabIndex:-1,showNavigator:!1,showNavigationControl:!1,showSequenceControl:!1,magnifier:null,immediateRender:!0,blendTime:0,animationTime:0,autoResize:i.autoResize,minZoomImageRatio:1}),e.setElementTouchActionNone(this.element),this.borderWidth=2,this.totalBorderWidths=new e.Point(2*this.borderWidth,2*this.borderWidth),i.controlOptions.anchor!==e.ControlAnchor.NONE&&!function(e,t){e.margin="0px",e.border=t+"px solid #555",e.padding="0px",e.background="#000",e.overflow="hidden"}(this.element.style,this.borderWidth),this.displayRegion=e.makeNeutralElement("div"),this.displayRegion.id=this.element.id+"-displayregion",this.displayRegion.className="displayregion",function(e,t){e.position="absolute",e.border=t+"px solid #900",e.margin="0px",e.padding="0px",e.cursor="move"}(this.displayRegion.style,this.borderWidth),r.addControl(this.element,i.controlOptions),this._resizeWithViewer=i.controlOptions.anchor!==e.ControlAnchor.ABSOLUTE&&i.controlOptions.anchor!==e.ControlAnchor.NONE,this._resizeWithViewer&&(i.width&&i.height?(this.element.style.height="number"==typeof i.height?i.height+"px":i.height,this.element.style.width="number"==typeof i.width?i.width+"px":i.width):(o=e.getElementSize(r.element),this.element.style.height=Math.round(o.y*i.sizeRatio)+"px",this.element.style.width=Math.round(o.x*i.sizeRatio)+"px",this.oldViewerSize=o),n=e.getElementSize(this.element),this.elementArea=n.x*n.y),this.oldContainerSize=new e.Point(0,0),e.Viewer.apply(this,[i]),r.canvas.appendChild(this.displayRegion),i.magnifierRotate&&r.addHandler("rotate",function(e){a.viewport.setRotation(e.degrees)}),this.addHandler("reset-size",function(){a.viewport&&a.viewport.goHome(!0)}),this.addHandler("update-level",function(){r.viewport&&a.update(r.viewport)}),r.addHandler("update-level",function(){r.viewport&&a.update(r.viewport)}),r.addHandler("close",function(){a.close()}),r.addHandler("full-page",function(){r.viewport&&a.update(r.viewport)}),r.addHandler("full-screen",function(){r.viewport&&a.update(r.viewport)}),r.world.addHandler("update-viewport",function(){r.viewport&&a.update(r.viewport)}),r.world.addHandler("item-index-change",function(e){var t=a.world.getItemAt(e.previousIndex);a.world.setItemIndex(t,e.newIndex)}),r.world.addHandler("remove-item",function(e){var t=e.item,i=a._getMatchingItem(t);i&&a.world.removeItem(i)}),t(this,r),this.update(r.viewport)},e.extend(e.Magnifier.prototype,e.Viewer.prototype,{updateSize:function(){if(this.viewport){var t=new e.Point(0===this.container.clientWidth?1:this.container.clientWidth,0===this.container.clientHeight?1:this.container.clientHeight);t.equals(this.oldContainerSize)||(this.viewport.resize(t,!0),this.viewport.goHome(!0),this.oldContainerSize=t,this.drawer.clear(),this.world.draw())}},update:function(t){var i,o,n,r,a,d;if(i=e.getElementSize(this.viewer.element),this._resizeWithViewer&&i.x&&i.y&&!i.equals(this.oldViewerSize)&&(this.oldViewerSize=i,this.maintainSizeRatio||!this.elementArea?(o=i.x*this.sizeRatio,n=i.y*this.sizeRatio):(o=Math.sqrt(this.elementArea*(i.x/i.y)),n=this.elementArea/o),this.element.style.width=Math.round(o)+"px",this.element.style.height=Math.round(n)+"px",this.elementArea||(this.elementArea=o*n),this.updateSize()),t&&this.viewport){r=this.viewport.getBounds(!0),a=t.pixelFromPoint(r.getTopLeft(),!0),d=t.pixelFromPoint(r.getBottomRight(),!0).minus(this.totalBorderWidths);var s=this.displayRegion.style;s.display=this.world.getItemCount()?"block":"none";var l=a.rotate(this.viewport.degrees,new e.Point(0,0));console.log(a,l),s.top=Math.round(l.y)+"px",s.left=Math.round(l.x)+"px";var h=Math.abs(a.x-d.x),m=Math.abs(a.y-d.y);s.width=Math.round(Math.max(h,0))+"px",s.height=Math.round(Math.max(m,0))+"px"}},addTiledImage:function(t){var i=this,o=t.originalTiledImage;delete t.original;var n=e.extend({},t,{success:function(e){var t=e.item;t._originalForNavigator=o,i._matchBounds(t,o,!0),o.addHandler("bounds-change",function(){i._matchBounds(t,o)})}});return e.Viewer.prototype.addTiledImage.apply(this,[n])},_getMatchingItem:function(e){for(var t,i=this.world.getItemCount(),o=0;i>o;o++)if(t=this.world.getItemAt(o),t._originalForNavigator===e)return t;return null},_matchBounds:function(e,t,i){var o=t.getBounds();e.setPosition(o.getTopLeft(),i),e.setWidth(o.width,i)}})}(OpenSeadragon);
//# sourceMappingURL=openseadragonmagnifier.js.map
